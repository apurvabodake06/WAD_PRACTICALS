<!DOCTYPE html>
<html>
<head>
  <title>AJAX Register/Login</title>
</head>
<body>
  <h2>Register</h2>
  <form id="registerForm">
    Name: <input id="name" required><br>
    Email: <input id="email" type="email" required><br>
    Mobile: <input id="mobile" pattern="\d{10}" required><br>
    DOB: <input id="dob" type="date" required><br>
    City: <input id="city" required><br>
    Address: <input id="address" required><br>
    Username: <input id="username" required><br>
    Password: <input id="password" type="password" required><br>
    <button type="submit">Register</button>
  </form>

  <h2>Login</h2>
  <form id="loginForm">
    Username: <input id="loginUsername" required><br>
    Password: <input id="loginPassword" type="password" required><br>
    <button type="submit">Login</button>
  </form>

  <script>
    // Register
    document.getElementById("registerForm").addEventListener("submit", function(e) {
      e.preventDefault();
      const user = {
        name: name.value,
        email: email.value,
        mobile: mobile.value,
        dob: dob.value,
        city: city.value,
        address: address.value,
        username: username.value,
        password: password.value
      };

      fetch("/register", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify(user)
      })
      .then(res => res.json())
      .then(data => alert(data.message))
      .catch(err => console.error("Error:", err));
    });

    // Login
    document.getElementById("loginForm").addEventListener("submit", function(e) {
      e.preventDefault();
      fetch("/login", {
        method: "POST",
        headers: { "Content-Type": "application/json" },
        body: JSON.stringify({
          username: loginUsername.value,
          password: loginPassword.value
        })
      })
      .then(res => {
        if (!res.ok) throw new Error("Invalid credentials");
        return res.json();
      })
      .then(data => {
        alert(data.message);
        window.location.href = "users.html";
      })
      .catch(err => alert(err.message));
    });
  </script>
</body>
</html>
